## joel 12장 질문

### Q. Long-polling과 WebSocket 사이에서 선택 기준은 무엇일까요? 어떤 상황에서는 Long-polling이 더 적합할 수 있을까요?
- 모든 서비스가 웹소켓을 사용하지는 않습니다. 극도로 단순한 기능의 채팅이나 특정 네트워크 환경을 고려할 때, 롱폴링이 더 합리적인 선택이 되는 시나리오에 대해 토론해 보세요.
- 라운지 Notification에서는 SSE를 사용하기도 했었는데... 
    ```
    - SSE가 채팅 설계에 부적합한 핵심 이유: 단방향 통신
    SSE는 서버가 클라이언트에게 일방적으로 데이터를 푸시(push)하는 상황에 최적화되어 있습니다. 
    예를 들어 주식 시세 업데이트, 스포츠 경기 점수, 실시간 뉴스 피드처럼 사용자의 입력 없이 서버의 정보만 받아서 화면에 보여주는 기능에 매우 효과적입니다.
    하지만 채팅은 다릅니다.
    
    1. 클라이언트의 메시지 전송: 채팅의 가장 기본 기능은 사용자가 메시지를 입력해 서버로 보내는 것입니다. SSE는 이 '클라이언트 → 서버' 방향의 통신 채널을 제공하지 않습니다.
    
    2. 억지로 구현한다면?: SSE로 채팅을 구현하려면, 사용자가 메시지를 보낼 때마다 별도의 HTTP 요청(예: POST 요청)을 새로 만들어야 합니다. 
    즉, '서버 → 클라이언트'는 SSE 연결을 사용하고, '클라이언트 → 서버'는 전통적인 HTTP 요청을 사용하는 '반쪽짜리' 실시간 통신이 됩니다.
    
    3. 비효율 발생: 이 방식은 메시지를 보낼 때마다 새로운 HTTP 연결을 맺고 헤더 정보를 교환해야 하므로, 메시지 교환이 잦은 채팅 환경에서는 상당한 오버헤드와 지연을 유발합니다. 
    이는 실시간 통신의 장점을 상쇄시키는 비효율적인 구조입니다.
    ```

### Q. 100명 그룹 채팅과 100만 명 오픈 채팅방의 메시지 전송 아키텍처는 어떻게 달라야 할까요?
- 100명에게 메시지를 복사해 큐에 넣는 방식("Fan-out on write")은 100만 명에게는 비효율적입니다. 
- 이 경우 **메시지를 한 번만 쓰고, 사용자들이 각자 가져가게 하는 방식("Fan-out on read")**을 사용한다면 어떻게 설계해야 할까요? 
- 각 방식의 장단점을 비교해 보세요.

### Q. 무중단 배포를 도입하기 위해서는 웹소켓 연결을 재연결해야하는데, 이를 가능하게 하는 방법?
- "재연결하세요" 메시지 전송: 신호를 받은 구버전 서버는 자신이 관리하던 모든 활성 웹소켓 연결에 **"서버가 재시작되니 재연결이 필요하다"**는 의미의 **특정 종료 코드(Custom Close Code)**와 함께 종료 메시지를 보냅니다. (예: 4000번 코드)
- 이 '의도된' 코드를 받은 클라이언트는 이것이 네트워크 에러가 아님을 인지하고, 즉시(또는 짧은 지연 후) 재연결을 시도할 수 있습니다.
